#Workflow name
name: Build Spring Boot application with GitHub Actions
on:
  #Manually trigger workflow runs
  workflow_dispatch:
  #Trigger the workflow on push from the main branch
  push:
    branches:
      - main
jobs:
  # Build's job
  build:
    name: Build the application
    #Run on Ubuntu using the latest version
    runs-on: ubuntu-latest
    services:
      mysql:
        image: mysql/mysql-server:5.7
        env:
          MYSQL_DATABASE: test_database
          MYSQL_HOST: 127.0.0.1
          MYSQL_USER: admin
          MYSQL_PASSWORD: rootpass
          MYSQL_ROOT_PASSWORD: rootpass
    #Job's steps
    steps:
     # Checkout code
     - uses: actions/checkout@v2
     # Setup Java
     - uses: actions/setup-java@v2
       with:
         distribution: 'adopt' # See 'Supported distributions' for available options
         java-version: '11'
         cache: 'maven'
     # Build Spring boot
     - name: Build the project
       run: mvn -B -DskipTests install
     # Login to Docker registry  
     - name: Docker Login
       uses: docker/login-action@v1.10.0
       with:
        # Server address of Docker registry. If not set then will default to Docker Hub
        registry: ghcr.io
        username: ${{ github.actor }}
        password: ${{ secrets.GITHUB_TOKEN }}
        # Log out from the Docker registry at the end of a job
        logout: true
     # Build Docker image  
     - name: Build Docker
       run: mvn jib:build
